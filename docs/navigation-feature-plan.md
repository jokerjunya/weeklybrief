# レポートナビゲーション機能 - 要件定義と開発計画

## 📋 機能概要

週次レポートの履歴化されたWebファイル間を移動するためのナビゲーション機能

## 🎯 要件定義

### 基本要件
- **前回のレポートを見る**ボタン
- **次回のレポートを見る**ボタン
- 時系列順でのレポート間移動
- 現在表示中のレポート日付の表示

### 詳細仕様

#### UI要件
- ヘッダー部分にナビゲーションボタンを配置
- ボタンデザインは既存のテーマトグル・エクスポートボタンと統一
- 利用不可状態（最新/最古レポート）では無効化表示
- キーボードショートカット対応（← → 矢印キー）

#### 機能要件
1. **ファイル検索機能**
   - `web/` ディレクトリ内の履歴ファイル一覧取得
   - ファイル名から日付・時刻の抽出・ソート
   - 現在表示中ファイルの特定

2. **ナビゲーション機能**
   - 前後のレポートファイルへの移動
   - URLパラメータによる直接アクセス対応
   - ブラウザ履歴との連携

3. **状態管理**
   - 現在位置の把握
   - ボタンの有効/無効状態制御

## 🔧 技術的検討

### 実装方式の選択肢

#### 方式A: クライアントサイドJavaScript
**メリット**:
- シンプルな実装
- サーバー不要
- 高速な動作

**デメリット**:
- ファイル一覧の動的取得が困難
- セキュリティ制限（CORS等）

#### 方式B: サーバーサイド処理
**メリット**:
- ファイルシステムへの完全アクセス
- 確実なファイル一覧取得

**デメリット**:
- 追加のサーバー実装が必要
- 複雑性の増加

#### 方式C: 静的ファイル生成時の情報埋め込み
**メリット**:
- 生成時に履歴情報を埋め込み
- クライアントサイドで完結
- 確実な動作

**デメリット**:
- 生成スクリプトの複雑化
- 全ファイルの再生成が必要

### 推奨実装方式

**方式C（静的情報埋め込み）** を推奨

理由：
- 現在の静的ファイル構成を維持
- 確実性と性能のバランス
- 既存の生成スクリプトとの親和性

## 📝 開発計画

### Phase 1: データ構造設計
1. **履歴管理データ構造**
   ```json
   {
     "reports": [
       {
         "filename": "週次レポート_web_20250622_104908.html",
         "date": "2025-06-22",
         "timestamp": "2025-06-22T10:49:08",
         "title": "週次レポート - 2025年06月22日"
       }
     ],
     "current_index": 0
   }
   ```

2. **JSON履歴ファイル**
   - `web/reports-history.json` として管理
   - 新規レポート生成時に更新

### Phase 2: 生成スクリプト拡張
1. **履歴管理機能追加**
   - `generate_web_html()` 関数の拡張
   - 履歴JSONファイルの更新処理
   - HTML内への履歴情報埋め込み

2. **HTML テンプレート修正**
   - ナビゲーションボタンの追加
   - JavaScript変数として履歴情報を埋め込み

### Phase 3: フロントエンド実装
1. **JavaScript機能**
   - ナビゲーション関数の実装
   - キーボードショートカット対応
   - URL操作（history API使用）

2. **CSS スタイリング**
   - ナビゲーションボタンのスタイル
   - 無効状態の表現

### Phase 4: 既存ファイル対応
1. **既存履歴ファイルの登録**
   - 既存の履歴ファイルを検索・登録
   - 履歴JSONファイルの初期化

2. **後方互換性確保**
   - 履歴情報がない場合の処理
   - グレースフルデグラデーション

## 🚧 実装上の課題

### 技術的課題
1. **ファイルパスの正規化**
   - 相対パス/絶対パスの統一
   - CSS/JSファイルへの正しい参照

2. **ブラウザキャッシュ対策**
   - 履歴情報の更新反映
   - 適切なキャッシュ制御

3. **エラーハンドリング**
   - 存在しないファイルへのアクセス
   - 破損した履歴データの処理

### UX課題
1. **読み込み時間**
   - 大量の履歴がある場合の性能
   - 遅延読み込みの検討

2. **アクセシビリティ**
   - スクリーンリーダー対応
   - キーボードナビゲーション

## 📊 実装優先度

### 高優先度
- [ ] 基本的な前後移動機能
- [ ] 履歴JSON管理
- [ ] ボタンUI実装

### 中優先度
- [ ] キーボードショートカット
- [ ] URL操作対応
- [ ] 既存ファイル自動登録

### 低優先度
- [ ] 高度なナビゲーション（日付ジャンプ等）
- [ ] 履歴検索機能
- [ ] パフォーマンス最適化

## 🔄 段階的実装

1. **MVP（最小限実装）**
   - 前後ボタンの基本機能のみ
   - 手動での履歴管理

2. **標準実装**
   - 自動履歴管理
   - キーボードサポート

3. **拡張実装**
   - 高度なナビゲーション機能
   - 検索・フィルタリング

---

*この計画書は実装前の検討資料です* 