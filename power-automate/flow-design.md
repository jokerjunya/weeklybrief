# Power Automate フロー設計

## メインフロー: 週次レポート生成

### トリガー
- **種類**: スケジュール実行
- **頻度**: 毎週月曜日 08:00 JST
- **タイムゾーン**: (UTC+09:00) 大阪、札幌、東京

### フロー順序

#### 1. 初期化
- [ ] 変数初期化（日付、エラーカウンター等）
- [ ] 設定値の読み込み

#### 2. データ収集フェーズ
- [ ] 売上データ取得（OneDrive/SharePoint）
- [ ] 株価データ取得（Alpha Vantage API）
- [ ] ニュースデータ取得（NewsAPI）
- [ ] スケジュールデータ取得（Outlook）

#### 3. データ処理フェーズ
- [ ] 売上データのパース・集計
- [ ] 株価データの整形
- [ ] ニュースデータのフィルタリング
- [ ] スケジュールデータの整形

#### 4. レポート生成フェーズ
- [ ] Google Docsテンプレートのコピー作成
- [ ] プレースホルダーの置換
- [ ] レポートファイルの保存

#### 5. 承認フェーズ
- [ ] Teams Adaptive Card作成
- [ ] Junyaへの承認依頼送信
- [ ] 承認待機

#### 6. 配信フェーズ（承認後トリガー）
- [ ] 最終レポートの Teams 投稿
- [ ] 完了通知

### エラーハンドリング
- 各ステップでのエラーキャッチ
- リトライ機能
- エラー通知

### 必要なコネクタ
1. OneDrive/SharePoint
2. HTTP（外部API用）
3. Office 365 Outlook
4. Microsoft Teams
5. Google Drive
6. Google Docs（HTTP経由）

## サブフロー: 承認レスポンス処理
- **トリガー**: Teams Adaptive Card レスポンス
- **処理**: OK押下時の最終配信実行 