#!/usr/bin/env python3
"""
Teams Chat IDå–å¾—ãƒ˜ãƒ«ãƒ‘ãƒ¼
Power Automateã§ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ä½œæˆã‚’ã‚¬ã‚¤ãƒ‰
"""

def print_teams_guide():
    """Teams Chat IDå–å¾—ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤º"""
    
    print("ğŸ” Teams Chat ID å–å¾—ã‚¬ã‚¤ãƒ‰")
    print("=" * 50)
    
    print("\nğŸ“‹ **æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ï¼ˆæ¨å¥¨ï¼‰**")
    print("1. Power Automate (make.powerautomate.com) ã«ã‚¢ã‚¯ã‚»ã‚¹")
    print("2. ã€Œæ–°ã—ã„ãƒ•ãƒ­ãƒ¼ã€â†’ã€Œæ‰‹å‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ãƒ­ãƒ¼ã€")
    print("3. ãƒ•ãƒ­ãƒ¼å: ã€ŒChat IDå–å¾—ãƒ†ã‚¹ãƒˆã€")
    print("4. ã€Œæ–°ã—ã„ã‚¹ãƒ†ãƒƒãƒ—ã€â†’ã€ŒMicrosoft Teamsã€")
    print("5. ã€Œãƒãƒ£ãƒƒãƒˆã¾ãŸã¯ãƒãƒ£ãƒãƒ«ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿ã€ã‚’é¸æŠ")
    print("6. è¨­å®š:")
    print("   - æŠ•ç¨¿è€…: ãƒ•ãƒ­ãƒ¼ ãƒœãƒƒãƒˆ")
    print("   - æŠ•ç¨¿å…ˆ: ãƒãƒ£ãƒƒãƒˆ")
    print("   - å—ä¿¡è€…: Junyaï¼ˆå€‹äººãƒãƒ£ãƒƒãƒˆã‚’é¸æŠï¼‰")
    print("   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€ŒChat IDå–å¾—ãƒ†ã‚¹ãƒˆã€")
    print("7. ã€Œä¿å­˜ã€â†’ã€Œãƒ†ã‚¹ãƒˆã€â†’ã€Œæ‰‹å‹•ã€â†’ã€Œä¿å­˜ã—ã¦ãƒ†ã‚¹ãƒˆã€")
    print("8. ã€Œå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯")
    print("9. å®Ÿè¡Œå¾Œã€ã€Œå®Ÿè¡Œã®å±¥æ­´ã€ã‚’ç¢ºèª")
    print("10. å®Ÿè¡Œãƒ­ã‚°ã§ã€Œãƒãƒ£ãƒƒãƒˆIDã€ã‚’ã‚³ãƒ”ãƒ¼")
    
    print("\nğŸ” **å–å¾—ã§ãã‚‹Chat IDã®å½¢å¼ä¾‹**:")
    print("19:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx@unq.gbl.spaces")
    
    print("\nâš™ï¸ **è¨­å®šæ–¹æ³•**:")
    print("å–å¾—ã—ãŸChat IDã‚’ä»¥ä¸‹ã«è¨­å®š:")
    print("ãƒ•ã‚¡ã‚¤ãƒ«: config/settings.json")
    print("å ´æ‰€: è¡Œç•ªå· ç´„55è¡Œç›®")
    print('   "chat_id": "ã“ã“ã«å–å¾—ã—ãŸChat IDã‚’è²¼ã‚Šä»˜ã‘"')
    
    print("\nğŸ§ª **è¨­å®šç¢ºèªæ–¹æ³•**:")
    print("python scripts/teams-chat-id-helper.py --test")
    
    print("\nâ“ **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:")
    print("- Junyaã¨ã®å€‹äººãƒãƒ£ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ:")
    print("  â†’ Teams ã§ã¾ãšç›´æ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’ä½œæˆ")
    print("- æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ:")
    print("  â†’ Power Automate ã§Teamsã‚³ãƒã‚¯ã‚¿ã«å†èªè¨¼")
    print("- Chat IDãŒç„¡åŠ¹ãªå ´åˆ:")
    print("  â†’ IDãŒæ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆæ”¹è¡Œã‚„ç©ºç™½ãªã—ï¼‰")

def test_chat_id():
    """è¨­å®šã•ã‚ŒãŸChat IDã‚’ãƒ†ã‚¹ãƒˆ"""
    import json
    
    try:
        with open('config/settings.json', 'r', encoding='utf-8') as f:
            config = json.load(f)
        
        chat_id = config['output']['teams']['chat_id']
        
        if chat_id == "CHAT_ID_TO_BE_PROVIDED":
            print("âŒ Chat IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
            print("   â†’ ä¸Šè¨˜ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦Chat IDã‚’å–å¾—ãƒ»è¨­å®šã—ã¦ãã ã•ã„")
            return False
        
        # Chat IDã®å½¢å¼ãƒã‚§ãƒƒã‚¯
        if chat_id.startswith("19:") and "@unq.gbl.spaces" in chat_id:
            print("âœ… Chat IDå½¢å¼: æ­£å¸¸")
            print(f"   è¨­å®šæ¸ˆã¿ID: {chat_id[:30]}...{chat_id[-20:]}")
            return True
        else:
            print("âš ï¸  Chat IDå½¢å¼ãŒä¸€èˆ¬çš„ã§ãªã„å½¢å¼ã§ã™")
            print(f"   è¨­å®šæ¸ˆã¿ID: {chat_id}")
            print("   â†’ æ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„")
            return False
            
    except FileNotFoundError:
        print("âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: config/settings.json")
        return False
    except json.JSONDecodeError:
        print("âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®JSONå½¢å¼ãŒç„¡åŠ¹ã§ã™")
        return False
    except KeyError as e:
        print(f"âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å¿…è¦ãªã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“: {e}")
        return False

def create_test_flow_template():
    """Power Automateãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼ç”¨ã®JSONãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ"""
    
    template = {
        "flow_name": "Chat IDå–å¾—ãƒ†ã‚¹ãƒˆ",
        "trigger": {
            "type": "æ‰‹å‹•ã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ•ãƒ­ãƒ¼",
            "description": "æ‰‹å‹•å®Ÿè¡Œã§Chat IDã‚’å–å¾—"
        },
        "actions": [
            {
                "name": "Teams_ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŠ•ç¨¿",
                "type": "Microsoft Teams - ãƒãƒ£ãƒƒãƒˆã¾ãŸã¯ãƒãƒ£ãƒãƒ«ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ•ç¨¿",
                "settings": {
                    "æŠ•ç¨¿è€…": "ãƒ•ãƒ­ãƒ¼ ãƒœãƒƒãƒˆ",
                    "æŠ•ç¨¿å…ˆ": "ãƒãƒ£ãƒƒãƒˆ",
                    "å—ä¿¡è€…": "Junyaï¼ˆå€‹äººãƒãƒ£ãƒƒãƒˆï¼‰",
                    "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸": "Chat IDå–å¾—ãƒ†ã‚¹ãƒˆ - @{utcNow()}"
                }
            }
        ],
        "note": "å®Ÿè¡Œå¾Œã€å®Ÿè¡Œå±¥æ­´ã§ãƒãƒ£ãƒƒãƒˆIDã‚’ç¢ºèªã—ã¦ãã ã•ã„"
    }
    
    print("ğŸ“„ Power Automate ãƒ†ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼è¨­å®š")
    print("=" * 40)
    print(json.dumps(template, indent=2, ensure_ascii=False))

if __name__ == "__main__":
    import sys
    
    if len(sys.argv) > 1 and sys.argv[1] == "--test":
        print("ğŸ§ª Chat IDè¨­å®šãƒ†ã‚¹ãƒˆ")
        print("=" * 30)
        test_chat_id()
    elif len(sys.argv) > 1 and sys.argv[1] == "--template":
        create_test_flow_template()
    else:
        print_teams_guide()
        
        print("\nğŸ¯ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:")
        print("1. ä¸Šè¨˜ã®æ‰‹é †ã§Chat IDã‚’å–å¾—")
        print("2. config/settings.json ã«è¨­å®š")
        print("3. python scripts/teams-chat-id-helper.py --test ã§ç¢ºèª")
        print("4. æ¬¡ã®ã‚¿ã‚¹ã‚¯ï¼ˆPower AutomateåŸºæœ¬ãƒ•ãƒ­ãƒ¼ä½œæˆï¼‰ã«é€²ã‚€") 